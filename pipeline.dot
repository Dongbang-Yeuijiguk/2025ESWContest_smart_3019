digraph pipeline {
    graph [rankdir=TB, nodesep=0.25, ranksep=0.5, fontname="NanumGothic"];
    node  [shape=box, fontname="NanumGothic"];
    edge  [fontname="NanumGothic"];

    subgraph cluster1 {
        label="1. 데이터 수집"; style=rounded;
        n1 [label="Raw CSI 데이터"];
    }

    subgraph cluster2 {
        label="2. 데이터 전처리"; style=rounded;
        n2 [label="로드 & 진폭 추출"];
        n3 [label="노이즈 제거\n(DWT)"];
        n4 [label="차원 축소\n(PCA)"];
        n5 [label="저역 통과 필터\n(FFT)"];
        n2 -> n3 -> n4 -> n5;
    }

    subgraph cluster3 {
        label="3. 존재 감지"; style=rounded;
        n6 [label="사람 존재 여부?", shape=diamond];
    }

    subgraph cluster4 {
        label="4. 병렬 처리"; style=rounded;
        n7 [label="움직임 추론 모델"];
        n8 [label="BPM 계산 (FFT)"];
    }

    subgraph cluster5 {
        label="5. 결과 도출"; style=rounded;
        n9 [label="결과 통합\n{bpm:62, move:'sit', quality:'high'}"];
    }

    n1 -> n2;
    n5 -> n6;
    n6 -> n7 [label="사람 있음"];
    n6 -> n8 [label="사람 있음"];
    n6 -> n1 [label="사람 없음"]; // n10은 자동 생성됨(미정의여도 무방)
    n7 -> n9;
    n8 -> n9;
}
